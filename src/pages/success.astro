---
const userEmail = Astro.url.searchParams.get('email') || ''
const sessionId = Astro.url.searchParams.get('session_id') || ''

if (!userEmail || !sessionId) {
  return Astro.redirect('/')
}

const response = await fetch('https://api.gadmin.app/api/v2/landing/success-payment', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({ email: userEmail, sessionId: sessionId }),
}).then((res) => res.json())

if (!response.data.ok) {
  return Astro.redirect('/?successError=true')
}
---

<html lang='en'>
  <head>
    <meta charset='UTF-8' />
    <title>Pago Exitoso</title>
  </head>
  <body>
    <h1>Â¡Gracias por tu compra!</h1>
    <p>Tu pago ha sido procesado exitosamente.</p>
  </body>
</html>
